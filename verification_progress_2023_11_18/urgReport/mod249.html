<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Author" content="<username>"> <meta name="GENERATOR" content="urg/version [en] (platform name) [urg]">
<title>Unified Coverage Report :: Module :: CTU_CAN_FD_TB.BTR_FD_FTEST</title>
<link type="text/css" rel="stylesheet" href="css/.urg.css">
<link type="text/css" rel="stylesheet" href="css/.layout.css">
<link type="text/css" rel="stylesheet" href="css/.breadcrumb.css">
<script type="text/javascript" src="js/.jquery.js"></script>
<script type="text/javascript" src="js/.jquery-ui.js"></script>
<script type="text/javascript" src="js/.sortable.js"></script>
<script type="text/javascript" src="js/.layout.js"></script>
<script type="text/javascript" src="js/.breadcrumb.js"></script>
<script type="text/javascript">
var layout, westLayout, centerLayout;
$(document).ready(function () {
  if ($("#north-bread-crumb")) {
    $("#north-bread-crumb").jBreadCrumb({easing:'swing'})
  }
  layout = $("body").layout({ 
    resizable: true,
    spacing_open: 4,
    spacing_closed: 4,
    north: {
      size: 76
    },
    south: {
      size: 45,
      initClosed: true
    },
    west: {
      size: 500,
      resizable: true,
      initClosed: false
    }
  });
  centerLayout = $('div.ui-layout-center').layout({
    north__paneSelector: ".ui-layout-center-inner-north",
    center__paneSelector: ".ui-layout-center-inner-center", 
    north__size: 50,
    spacing_open: 4,
    spacing_closed: 4
  });
});
</script>
</head>
<body onLoad="initPage();"><div class="ui-layout-north">
<div class="logo"></div>
<center class="pagetitle">Module Definition</center>
<div align="center"><a href="dashboard.html" ><b>dashboard</b></a> | <a href="hierarchy.html" ><b>hierarchy</b></a> | <a href="modlist.html" ><b>modlist</b></a> | groups | <a href="tests.html" ><b>tests</b></a> | <a href="asserts.html" ><b>asserts</b></a></div>

</div>
<div class="ui-layout-west">
<div name='tag_CTU_CAN_FD_TB.BTR_FD_FTEST'>
<div class=modhdr>
<br clear=all>
<span class=titlename>Module : <a href="#"  onclick="showContent('tag_CTU_CAN_FD_TB.BTR_FD_FTEST')">CTU_CAN_FD_TB.BTR_FD_FTEST</a></span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>FSM</td><td>BRANCH</td><td>ASSERT</td></tr><tr>
<td class="s10 cl rt">100.00</td>
<td class="s10 cl rt"><a href="mod249.html#Line" >100.00</a></td>
<td class="wht cl rt"></td>
<td class="wht cl rt"></td>
<td class="wht cl rt"></td>
<td class="wht cl rt"></td>
<td class="wht cl rt"></td>
</tr></table><br clear=all>
<span class=repname>Source File(s) : </span>
<br clear=all>
<a href="javascript:void(0);"  onclick="openSrcFile('/home/oille/Downloads/ctucanfd_ip_core/test/main_tb/feature_tests/btr_fd_ftest.vhd')">/home/oille/Downloads/ctucanfd_ip_core/test/main_tb/feature_tests/btr_fd_ftest.vhd</a><br clear=all>
<br clear=all>
<span class=repname>Module self-instances :</span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td class="alfsrt">NAME</td><td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>FSM</td><td>BRANCH</td><td>ASSERT</td></tr></table></div>
</div>
<br clear=all>
</div>
<div class="ui-layout-center">
<div class="ui-layout-center-inner-center">
<div name='tag_CTU_CAN_FD_TB.BTR_FD_FTEST'>
<a name="Line"></a>
Line Coverage for Module : <a href="mod249.html" >CTU_CAN_FD_TB.BTR_FD_FTEST</a><br clear=all>
<table class="noborder">
<col width="122">
<col span="4" width="82">
<tr><th></th><th>Line No.</th><th>Total</th><th>Covered</th><th>Percent</th></tr>
<tr class="s10"><td class="lf">TOTAL</td><td></td><td>65</td><td>65</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">VHDL_PROCEDURE</td><td>138</td><td>65</td><td>65</td><td>100.00</td></tr>
</table>
<pre class="code"><br clear=all>
137                             -----------------------------------------------------------------------
138        1/1                  info_m(&quot;Step 1&quot;);
139                     
140        1/1                  CAN_turn_controller(false, DUT_NODE, chn);
141        1/1                  CAN_turn_controller(false, TEST_NODE, chn);
142                     
143                             -- Read timing so that NBT values are kept!
144        1/1                  CAN_read_timing_v(bus_timing, DUT_NODE, chn);
145                     
146        1/1                  CAN_generate_random_bit_timing(bus_timing, chn);
147                     
148                             -- Constrain nominal bit-timing to reduce test time!
149                             -- This is test which verifies data bit-rate so we can afford some
150                             -- relaxations in nominal bit rate.
151        1/1                  if (bus_timing.tq_nbt &gt; 10) then
152        1/1                      bus_timing.tq_nbt := 10;
153                             end if;
154        1/1                  if (bus_timing.prop_nbt &gt; 20) then
155        1/1                      bus_timing.prop_nbt := 20;
156                             end if;
157        1/1                  if (bus_timing.ph1_nbt &gt; 15) then
158        1/1                      bus_timing.ph1_nbt := 15;
159                             end if;
160        1/1                  if (bus_timing.ph2_nbt &gt; 15) then
161        1/1                      bus_timing.ph2_nbt := 15;
162                             end if;
163        1/1                  CAN_print_timing(bus_timing);
164                     
165                             -----------------------------------------------------------------------
166                             -- Configure delay of TX -&gt; RX so that for any generated bit-rate, it
167                             -- is not too high! Otherwise, roundtrip will be too high and Node will
168                             -- not manage to receive ACK in time!
169                             -- Before sample point, whole roundtrip must be made (and 2 more clock
170                             -- cycles due to input delay!). Lets take the delay as one third of
171                             -- TSEG1. Roundtrip will take two thirds and we should be safe!
172                             -----------------------------------------------------------------------
173        1/1                  tx_delay := (((1 + bus_timing.prop_nbt + bus_timing.ph1_nbt) *
174                                            bus_timing.tq_nbt) / 3) * 10 ns;
175        1/1                  info_m(&quot;TX delay is: &quot; &amp; time'image(tx_delay));
176        1/1                  ftr_tb_set_tran_delay(tx_delay, DUT_NODE, chn);
177        1/1                  ftr_tb_set_tran_delay(tx_delay, TEST_NODE, chn);
178                     
179                     
180                             -- Pre-calculate expected number of clock cycles after all corrections!
181        1/1                  clock_per_bit := (1 + bus_timing.prop_dbt + bus_timing.ph1_dbt +
182                                               bus_timing.ph2_dbt) * bus_timing.tq_dbt;
183                     
184        1/1                  CAN_configure_timing(bus_timing, DUT_NODE, chn);
185        1/1                  CAN_configure_timing(bus_timing, TEST_NODE, chn);
186                     
187                             -- Configure SSP so that it samples in Data-bit rate and in 50 % of
188                             -- expected received bit! We need it only for DUT!
189        1/1                  ssp_pos := std_logic_vector(to_unsigned(clock_per_bit/2, 8));
190        1/1                  CAN_configure_ssp(ssp_meas_n_offset, ssp_pos, DUT_NODE, chn);
191                     
192                             -----------------------------------------------------------------------
193                             -- @2. Enable both Nodes and send CAN FD frame where bit-rate is shifted
194                             --    by DUT. Wait until data field in DUT and measure duration
195                             --    till next sample point! Transmitter during Data phase shall no
196                             --    re-synchronize therefore, bit time will always have nominal length!
197                             -----------------------------------------------------------------------
198        1/1                  info_m(&quot;Step 2&quot;);
199                     
200        1/1                  CAN_turn_controller(true, DUT_NODE, chn);
201        1/1                  CAN_turn_controller(true, TEST_NODE, chn);
202                     
203        1/1                  CAN_wait_bus_on(DUT_NODE, chn);
204        1/1                  CAN_wait_bus_on(TEST_NODE, chn);
205                     
206        1/1                  info_m(&quot;CAN bus nominal bit-rate:&quot;);
207        1/1                  info_m(&quot;BRP: &quot; &amp; integer'image(bus_timing.tq_nbt));
208        1/1                  info_m(&quot;PROP: &quot; &amp; integer'image(bus_timing.prop_nbt));
209        1/1                  info_m(&quot;PH1: &quot; &amp; integer'image(bus_timing.ph1_nbt));
210        1/1                  info_m(&quot;PH2: &quot; &amp; integer'image(bus_timing.ph2_nbt));
211        1/1                  info_m(&quot;SJW: &quot; &amp; integer'image(bus_timing.sjw_nbt));
212                     
213        1/1                  info_m(&quot;CAN bus Data bit-rate:&quot;);
214        1/1                  info_m(&quot;BRP: &quot; &amp; integer'image(bus_timing.tq_dbt));
215        1/1                  info_m(&quot;PROP: &quot; &amp; integer'image(bus_timing.prop_dbt));
216        1/1                  info_m(&quot;PH1: &quot; &amp; integer'image(bus_timing.ph1_dbt));
217        1/1                  info_m(&quot;PH2: &quot; &amp; integer'image(bus_timing.ph2_dbt));
218        1/1                  info_m(&quot;SJW: &quot; &amp; integer'image(bus_timing.sjw_dbt));
219                     
220        1/1                  CAN_generate_frame(CAN_frame_1);
221        1/1                  CAN_frame_1.brs := BR_SHIFT;
222        1/1                  CAN_frame_1.frame_format := FD_CAN;
223                     
224                             -- Force DLC length to 1 byte only not to have long test run time!
225        1/1                  CAN_frame_1.dlc := &quot;0001&quot;;
226        1/1                  decode_dlc(CAN_frame_1.dlc, CAN_frame_1.data_length);
227        1/1                  CAN_frame_1.data(0) := x&quot;AA&quot;;
228                     
229                             -- We need to make sure that frame is not RTR frame, because CAN FD
230                             -- frames have no RTR frames! This would lead to fail in check between
231                             -- TX and RX frame! Also, we have to re-calculate RWCNT for the check
232                             -- accordingly!
233        1/1                  CAN_frame_1.rtr := NO_RTR_FRAME;
234        1/1                  decode_dlc_rx_buff(CAN_frame_1.dlc, CAN_frame_1.rwcnt);
235                     
236                             -- These data bytes are preloaded to have all elements of memory word
237                             -- defined!
238        1/1                  CAN_frame_1.data(1) := x&quot;BB&quot;;
239        1/1                  CAN_frame_1.data(2) := x&quot;CC&quot;;
240        1/1                  CAN_frame_1.data(3) := x&quot;DD&quot;;
241                         
242        1/1                  CAN_send_frame(CAN_frame_1, 1, DUT_NODE, chn, frame_sent);
243        1/1                  CAN_wait_pc_state(pc_deb_data, DUT_NODE, chn);
244                     
245        1/1                  CAN_wait_sample_point(DUT_NODE, chn, false);
246        1/1                  t_meas_start := now;
247        1/1                  CAN_wait_sample_point(DUT_NODE, chn, false);
248        1/1                  t_meas_stop := now;
249                     
250        1/1                  clk_agent_get_period(chn, clk_sys_period);
251                     
252        1/1                  clock_meas := ((t_meas_stop - t_meas_start) / clk_sys_period);
253                             
254        1/1                  check_m(clock_per_bit = clock_meas,
255                                 &quot; Expected clock per bit: &quot; &amp; integer'image(clock_per_bit) &amp;
256                                 &quot; Measured clock per bit: &quot; &amp; integer'image(clock_meas));        
257                     
258                             -----------------------------------------------------------------------
259                             -- @3. Wait until frame is sent and check it is correctly received by
260                             --    Test node.
261                             -----------------------------------------------------------------------
262        1/1                  info_m(&quot;Step 3&quot;);
263                     
264        1/1                  CAN_wait_bus_idle(TEST_NODE, chn);
265        1/1                  CAN_read_frame(CAN_frame_2, TEST_NODE, chn);
266                     
267        1/1                  CAN_compare_frames(CAN_frame_1, CAN_frame_2, false, frames_equal);
268        1/1                  check_m(frames_equal, &quot;TX/RX frame equal!&quot;);
</pre>
</div>
</div>
<div class="ui-layout-center-inner-north">
<div id="center-bread-crumb" class="breadCrumb module urg-margin-bottom">
  <ul name="tag_CTU_CAN_FD_TB.BTR_FD_FTEST">
    <li>
      <a href="#Line">Line</a>    </li>
  </ul>
</div>
</div>
</div>
<div class="ui-layout-south">
<table align=center><tr><td class="s0 cl">0%</td>
<td class="s1 cl">10%</td>
<td class="s2 cl">20%</td>
<td class="s3 cl">30%</td>
<td class="s4 cl">40%</td>
<td class="s5 cl">50%</td>
<td class="s6 cl">60%</td>
<td class="s7 cl">70%</td>
<td class="s8 cl">80%</td>
<td class="s9 cl">90%</td>
<td class="s10 cl">100%</td></tr></table></div>
</body>
</html>
